Revised and edited source code.
